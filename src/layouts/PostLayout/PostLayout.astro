---
import Layout from "../Layout.astro";
import PrevNext from "./PrevNext.astro";
import Author from "./Author.astro";
import Rocket from "./Rocket.astro";
import CommentForm from "./CommentForm.astro";
import Comments from "./Comments.astro";
import generateTOC from "./generateTOC.js";
import Time from "../../components/Time.astro";
import Taxonomy from "../../components/Taxonomy.astro";

import { createRequire } from "node:module";
const moduleRequire = createRequire(import.meta.url);
const { JSDOM } = moduleRequire("jsdom");

const { title, post, prevNext } = Astro.props;

const { document } = new JSDOM(post.content.rendered).window;

const TOC = generateTOC(document);
---

<Layout title={title}>
  <div
    slot="wave"
    class="bg-gradient-to-b from-blue-200 to-[#b9daff] px-16 py-8"
  >
    <h1 class="pacific !text-red-700">{title}</h1>
    <div class="text-lg text-gray-700 italic">
      By {post._embedded.author[0].name + " â€¢ "}
      <Time time={post.modified} />
    </div>
  </div>

  <div class="flex md:flex-col">
    <section class="content flex flex-col w-2/3 md:w-full p-8">
      <div>
        <article id={post.id}>{document.body.innerHTML}</article>
        <div class="flex flex-wrap justify-between items-center italic gap-4 py-4">
          <Time time={post.date} />
          <Time time={post.modified} modified />
          <Taxonomy term="topic" array={post._embedded["wp:term"][0]} />
          <Taxonomy term="tag" array={post._embedded["wp:term"][1]} />
        </div>
      </div>
      <PrevNext data={prevNext} />
      <Author author={post._embedded.author[0]} />
      <CommentForm />
      <Comments />
    </section>
    <section class="sidebar w-1/3 md:w-full p-8">
      <h2 class="pacific toc">Table Of Contents</h2>
      {TOC}
      <Rocket />
    </section>
  </div>

  <script src={Astro.resolve("../../scripts/postlayout.js")}></script>
</Layout>
