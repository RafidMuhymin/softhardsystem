---
import Layout from "../Layout.astro";
import PrevNext from "./PrevNext.astro";
import Author from "./Author.astro";
import Rocket from "./Rocket.astro";
import Comment from "./Comment.astro";
import generateTOC from "./generateTOC.js";
import Time from "../../components/Time.astro";
import Taxonomy from "../../components/Taxonomy.astro";

import { createRequire } from "node:module";
const moduleRequire = createRequire(import.meta.url);
const { JSDOM } = moduleRequire("jsdom");

const { title, post, prevNext } = Astro.props;

const { document } = new JSDOM(post.content.rendered).window;

document.body.innerHTML = `<h1>${title}</h1>` + document.body.innerHTML;

const TOC = generateTOC(document);
---
<Layout title={title} post={post}>
  <div class="flex md:flex-col">
    <section class="content flex flex-col gap-6 w-2/3 md:w-full p-8">
      <div>
        {document.body.innerHTML}
        <div class="flex flex-wrap justify-between items-center italic gap-4 py-4">
          <Time time={post.modified} />
          <Time time={post.date} modified />
          <Taxonomy term="topic" array={post._embedded["wp:term"][0]} />
          <Taxonomy term="tag" array={post._embedded["wp:term"][1]} />
        </div>
      </div>
      <PrevNext data={prevNext} />
      <Author author={post._embedded.author[0]} />
      {import.meta.env.NODE_ENV === "development" && <Comment />}
    </section>
    <section class="sidebar w-1/3 md:w-full p-8">
      <h2 class="pacific">Table Of Contents</h2>
      {TOC}
      <Rocket />
    </section>
  </div>
</Layout>
